(()=>{var S=Object.defineProperty,T=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var b=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,C=(s,e)=>{for(var t in e||(e={}))k.call(e,t)&&b(s,t,e[t]);if(_)for(var t of _(e))E.call(e,t)&&b(s,t,e[t]);return s},A=(s,e)=>T(s,x(e));var l=(s,e,t)=>new Promise((n,i)=>{var r=c=>{try{a(t.next(c))}catch(p){i(p)}},o=c=>{try{a(t.throw(c))}catch(p){i(p)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(r,o);a((t=t.apply(s,e)).next())});function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){let e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}function I(){let s=window.innerWidth;return s<576?{bottom:"1%"}:s<1025?{bottom:"2%"}:{bottom:"1%"}}function v(s,e){let t=window.innerWidth,n=e?s:U();return t<576?`${n}/mobile.gif`:t<1100?`${n}/tablet.gif`:t<1955?`${n}/desktop.gif`:`${n}/large.gif`}function U(){return config.HydroDefaultBannerPath}var d={callUrl:"https://dev-ade-an.hydro.online",bidUrl:"https://dev-bid-router-an.hydro.online",eventURl:"https://dev-events-an.hydro.online",encryptionKey:"u8vB3tY5wQz9LmNp4RfXc2PkSjVh6DnO",HydroDefaultBannerPath:"https://dev-creativestore-an.hydro.online/ad_hydro_default",impressionDelay:parseInt("29000",10),useEncryption:!1,tagConfigUrl:"https://ad-traffic-regulation-config.hydro.online/tags.json"};function D(){return{countryCode:new URLSearchParams(document.currentScript.src.split("?")[1]).get("country_code")}}var f=class{constructor(){this.sessionData={hostname:window.location.hostname,adSessionId:null,adClicked:!1,clickTimestamp:null,timeDelay:18e4,countryCode:D().countryCode,lastAccessed:Date.now(),alreadyShownAds:[]},this.initialize()}initialize(){let e=sessionStorage.getItem("adSessionData");if(e){let t=JSON.parse(e);t.hostname===window.location.hostname?(this.sessionData=A(C({},t),{lastAccessed:Date.now(),countryCode:D().countryCode}),this.save()):this.reset()}else this.reset()}reset(){this.sessionData=A(C({},this.sessionData),{adSessionId:u(),adClicked:!1,clickTimestamp:null,lastAccessed:Date.now(),alreadyShownAds:[]}),this.save()}save(){sessionStorage.setItem("adSessionData",JSON.stringify(this.sessionData))}get adSessionId(){return this.sessionData.adSessionId}get countryCode(){return this.sessionData.countryCode}get alreadyShownAds(){return this.sessionData.alreadyShownAds}addShownAd(e){this.sessionData.alreadyShownAds.includes(e)||(this.sessionData.alreadyShownAds.push(e),this.save())}resetShownAds(){this.sessionData.alreadyShownAds=[],this.save()}recordClick(){this.sessionData.adClicked=!0,this.sessionData.clickTimestamp=Date.now(),this.save()}shouldShowAd(){return this.sessionData.adClicked?Date.now()-this.sessionData.clickTimestamp>=this.sessionData.timeDelay:!0}};var h={encrypt(s){if(!d.useEncryption)return s;let t=(o=>o.split("").map(a=>a.charCodeAt(0)))(d.encryptionKey),n=t.length,i=JSON.stringify(s).split("").map((o,a)=>o.charCodeAt(0)^t[a%n]),r=String.fromCharCode(...i);return btoa(r)},decrypt(s){if(!d.useEncryption)return s;try{let e=atob(s),t=d.encryptionKey.split("").map(o=>o.charCodeAt(0)),n=t.length,i=e.split("").map((o,a)=>o.charCodeAt(0)^t[a%n]),r=String.fromCharCode(...i);return JSON.parse(r)}catch(e){throw console.error("Decryption error:",e),new Error("Decryption failed")}},preparePayload(s){return d.useEncryption?{data:this.encrypt(s)}:s},processResponse(s){return d.useEncryption?this.decrypt(s.data):s}};var g=class{constructor(e){this.sessionManager=e,this.currentAdData=null,this.currentAdRequestId=null,this.isFetchingAd=!1,this.tagId=window.Hydro_tagId}fetchAd(){return l(this,null,function*(){if(this.isFetchingAd)return null;this.isFetchingAd=!0,this.currentAdRequestId=u();try{let e=`${d.bidUrl}/api/v1/ad/fetch`,t={ad_session_id:this.sessionManager.adSessionId,tag_id:this.tagId,ad_request_id:this.currentAdRequestId,pot_session_id:window.session_id,already_shown_ad_ids:this.sessionManager.alreadyShownAds.join(","),request_timestamp:Math.floor(Date.now()/1e3)},n=h.preparePayload(t),i=yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw new Error(`API response error: ${i.status}`);let r=yield i.json(),o=h.processResponse(r);return this.processResponseData(o),console.log("Ad fetched successfully:",this.currentAdData),this.currentAdData}catch(e){return console.error("Error fetching ad:",e),this.currentAdData=null,null}finally{this.isFetchingAd=!1}})}processResponseData(e){var t,n,i;if(!e)return null;if(e.seatbid&&e.seatbid.length>0&&e.seatbid[0].bid&&e.seatbid[0].bid.length>0){let r=e.seatbid[0].bid[0],o=((t=e.ext)==null?void 0:t.dsp_channel)||"",a=((n=e.ext)==null?void 0:n.device_type)||"";if(this.currentAdData={adReqId:e.id,campaignId:r.cid,deviceType:a,dspChannel:o,width:r.w,height:r.h,price:r.price,impid:r.impid,currency:e.cur,nurl:r.nurl,lurl:r.lurl,adm:r.adm,adid:r.adid,imageUrl:r.iurl,redirectUrl:o==="ad-kernel"?"":(i=r.ext)==null?void 0:i.redirect_url,pos:r.pos!==void 0?r.pos:5},this.currentAdData.rawBid=r,o==="ad-kernel"&&r.nurl){let c=r.nurl.replace("${AUCTION_PRICE}",r.price);this.triggerWinNotification(c)}return this.currentAdData.adId&&this.sessionManager.addShownAd(this.currentAdData.adId),this.currentAdData}return null}triggerWinNotification(e){return l(this,null,function*(){if(e)try{console.log("Attempting to send win notification to:",e);let t=yield fetch(e,{method:"GET",mode:"no-cors"});console.log("Win notification sent successfully to:",e)}catch(t){console.error("Error sending win notification:",t)}})}triggerLossNotification(e){return l(this,null,function*(){if(e)try{console.log("Attempting to send loss notification to:",e);let t=yield fetch(e,{method:"GET",mode:"no-cors"});console.log("Loss notification sent successfully to:",e)}catch(t){console.error("Error sending loss notification:",t)}})}getCurrentAdData(){return this.currentAdData}getCurrentAdRequestId(){return this.currentAdRequestId}};var m=class{constructor(e,t){this.sessionManager=e,this.adService=t}sendImpressionEvent(){return l(this,null,function*(){var t;let e=this.adService.getCurrentAdData();if(e)try{let n={ad_session_id:this.sessionManager.adSessionId,ad_id:e.adid,pot_session_id:window.session_id,ad_request_id:e.adReqId,ad_position:"middle",campaign_id:e.campaignId,tag_id:window.Hydro_tagId,device_type:e.deviceType,request_timestamp:Math.floor(Date.now()/1e3),bid_price:e.price,bid_currency:e.currency,dsp_channel:e.dspChannel,w:e.width,h:e.height,pos:e.pos,impid:e.impid};console.log("Impression Event Payload:",n);let i=h.preparePayload(n);if(console.log("Processed Payload:",i),e.dspChannel==="ad-kernel"){if(e.nurl){let c=e.nurl.replace("${AUCTION_PRICE}",e.price);yield this.triggerNotification(c)}(t=e.rawBid)!=null&&t.burl&&(yield this.triggerNotification(e.rawBid.burl));let r=yield fetch(`${d.eventURl}/api/v1/ad-display`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let o=yield r.json(),a=h.processResponse(o);console.log("Ad-kernel impression event sent:",a)}else if(e.dspChannel==="hydro"){let r=yield fetch(`${d.eventURl}/api/v1/ad-display`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let o=yield r.json(),a=h.processResponse(o);console.log("Hydro impression event sent:",a)}}catch(n){console.error("Error sending impression event:",n)}})}triggerNotification(e){return l(this,null,function*(){if(e)try{console.log("Attempting to send notification to:",e);let t=yield fetch(e,{method:"GET",mode:"no-cors"});console.log("Notification sent successfully to:",e)}catch(t){console.error("Error sending notification:",t)}})}sendClickEvent(){return l(this,null,function*(){let e=this.adService.getCurrentAdData();if(!e)return null;try{let t={ad_session_id:this.sessionManager.adSessionId,ad_id:e.adId||e.adid,pot_session_id:window.session_id,ad_request_id:this.adService.getCurrentAdRequestId(),campaign_id:e.campaignId,tag_id:window.Hydro_tagId,redirect_url:e.redirectUrl,device_type:e.deviceType,request_timestamp:Math.floor(Date.now()/1e3),bid_price:e.price,bid_currency:e.currency,dsp_channel:e.dspChannel,w:e.width,h:e.height,pos:e.pos,impid:e.impid};console.log("Click Event Payload:",t);let n=h.preparePayload(t);console.log("Processed Click Payload:",n);let i=yield fetch(`${d.eventURl}/api/v1/ad-click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let r=yield i.json(),o=h.processResponse(r);return console.log("Click event sent:",o),e.dspChannel==="hydro"&&e.redirectUrl?(window.open(e.redirectUrl,"_blank"),e.redirectUrl):null}catch(t){return console.error("Error sending click event:",t),null}})}};var y=class{constructor(e,t,n){this.sessionManager=e,this.adService=t,this.eventService=n,this.adContainer=null,this.isAdClosed=!0,this.currentAdRefreshTimer=null,this.currentImpressionTimer=null}createAdContainer(){this.adContainer?this.clearContainer():(this.adContainer=document.createElement("div"),document.body.appendChild(this.adContainer)),Object.assign(this.adContainer.style,{position:"fixed",zIndex:"2147483647",overflow:"hidden",display:"none",transition:"all 0.3s ease"})}displayBanner(){return l(this,null,function*(){let e=this.adService.getCurrentAdData();if(!e||!this.adContainer)return;this.clearContainer(),this.positionAdContainer(e.pos||0);let t=document.createElement("div");Object.assign(t.style,{position:"relative",transition:"all 0.3s ease",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"});try{if(e.dspChannel==="ad-kernel"&&e.adm){if(t.innerHTML=e.adm,!t.innerHTML.trim()){console.error("ADM content failed to render properly"),this.callLossUrl(e);return}t.querySelectorAll("a").forEach(n=>{n.getAttribute("target")||n.setAttribute("target","_blank")})}else{let n=document.createElement("img");n.id="hydro-ad-image",Object.assign(n.style,{display:"block",maxWidth:"100%",maxHeight:"100%",objectFit:"contain",cursor:"pointer"}),n.onerror=()=>{console.error("Failed to load ad image"),this.callLossUrl(e),this.clearContainer()},n.src=v(e.imageUrl,!0),n.addEventListener("click",()=>{e.redirectUrl&&(this.sessionManager.recordClick(),this.eventService.sendClickEvent(),window.open(e.redirectUrl,"_blank"))}),t.appendChild(n)}this.adContainer.appendChild(t),this.adContainer.style.display="block",this.isAdClosed=!1,window.addEventListener("resize",this.debounce(this.updateAdSize.bind(this),250)),this.currentImpressionTimer&&clearTimeout(this.currentImpressionTimer),this.currentImpressionTimer=setTimeout(()=>{this.eventService.sendImpressionEvent(),this.currentImpressionTimer=null},1e3),this.currentAdRefreshTimer&&clearTimeout(this.currentAdRefreshTimer),this.currentAdRefreshTimer=setTimeout(()=>{this.fetchNewAd(),this.currentAdRefreshTimer=null},d.impressionDelay)}catch(n){console.error("Error displaying banner:",n),this.callLossUrl(e),this.clearContainer()}})}callLossUrl(e){e&&e.lurl&&(console.log("Ad display failed, triggering loss URL"),this.adService.triggerLossNotification(e.lurl))}positionAdContainer(e){let t=I(),n=window.innerHeight,i=window.innerWidth;switch(Object.assign(this.adContainer.style,{top:"auto",right:"auto",bottom:"auto",left:"auto",width:"auto",height:"auto",margin:"0",transform:"none",position:"fixed",backgroundColor:"transparent",padding:"0",borderRadius:"0",display:"block",justifyContent:"normal",alignItems:"normal",maxWidth:"none",maxHeight:"none"}),parseInt(e)){case 0:this.adContainer.style.bottom="0",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)";break;case 1:this.adContainer.style.top="100px",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)";break;case 3:this.adContainer.style.top=`${n+50}px`,this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)",this.adContainer.style.position="absolute";break;case 4:this.adContainer.style.top="0",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)";break;case 5:this.adContainer.style.bottom="0",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)",this.adContainer.style.width="96%",this.adContainer.style.paddingInlineInline="2%",this.adContainer.style.marginBottom="2%";break;case 6:this.adContainer.style.top="150px",this.adContainer.style.right="0",this.adContainer.style.maxWidth="300px";break;case 7:Object.assign(this.adContainer.style,{top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center"});break}}updateAdSize(){if(!this.adContainer)return;let e=this.adService.getCurrentAdData();if(e&&(this.positionAdContainer(e.pos||0),e.dspChannel!=="ad-kernel")){let t=document.getElementById("hydro-ad-image");if(t)try{t.src=v(e.imageUrl,!0)}catch(n){console.error("Error updating ad image:",n),this.callLossUrl(e)}}}debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}closeAd(){this.clearContainer(),this.isAdClosed=!0}clearContainer(){this.currentImpressionTimer&&(clearTimeout(this.currentImpressionTimer),this.currentImpressionTimer=null),this.currentAdRefreshTimer&&(clearTimeout(this.currentAdRefreshTimer),this.currentAdRefreshTimer=null),this.adContainer&&(this.adContainer.style.display="none",this.adContainer.innerHTML="")}fetchNewAd(){return l(this,null,function*(){if(this.clearContainer(),!this.sessionManager.shouldShowAd())return console.log("Ad cannot be fetched. Waiting for delay period."),null;try{yield this.adService.fetchAd(),this.displayBanner()}catch(e){console.error("Error fetching new ad:",e)}})}};(function(){let s=new f,e=new g(s),t=new m(s,e),n=new y(s,e,t),i=!1;window.addEventListener("beforeunload",()=>{i=!0}),document.addEventListener("visibilitychange",function(){document.hidden?i||n.closeAd():n.isAdClosed&&s.shouldShowAd()&&o()}),window.addEventListener("focus",()=>{!i&&n.isAdClosed&&s.shouldShowAd()&&o()});function r(){return l(this,null,function*(){if(s.shouldShowAd())try{n.createAdContainer(),yield e.fetchAd(),n.displayBanner()}catch(a){console.error("Failed to initialize ad:",a)}})}function o(){return l(this,null,function*(){try{if(!window.Hydro_tagId){console.log("No Hydro tag ID found, proceeding with ads"),r();return}let a=d.tagConfigUrl,c=yield fetch(a);if(!c.ok){console.log("Could not load tag configuration, proceeding with ads"),r();return}let p=yield c.json(),w=window.Hydro_tagId;if(p&&p.tags&&p.tags[w]&&p.tags[w].show_ad===!1){console.log(`Tag ${w} is configured to not show ads`);return}r()}catch(a){console.error("Error checking tag configuration:",a),r()}})}o(),setInterval(()=>{s.sessionData.adClicked&&n.isAdClosed&&s.shouldShowAd()&&o()},5e3)})();})();
