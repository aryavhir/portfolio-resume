(()=>{var _=Object.defineProperty,I=Object.defineProperties;var T=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var D=(r,e,t)=>e in r?_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,w=(r,e)=>{for(var t in e||(e={}))k.call(e,t)&&D(r,t,e[t]);if(x)for(var t of x(e))E.call(e,t)&&D(r,t,e[t]);return r},A=(r,e)=>I(r,T(e));var l=(r,e,t)=>new Promise((n,i)=>{var o=c=>{try{a(t.next(c))}catch(h){i(h)}},s=c=>{try{a(t.throw(c))}catch(h){i(h)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(r,e)).next())});function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){let e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function S(){let r=window.innerWidth;return r<576?{bottom:"1%"}:r<1025?{bottom:"2%"}:{bottom:"1%"}}function v(r,e){let t=window.innerWidth,n=e?r:U();return t<576?`${n}/mobile.gif`:t<1100?`${n}/tablet.gif`:t<1955?`${n}/desktop.gif`:`${n}/large.gif`}function U(){return config.HydroDefaultBannerPath}var d={callUrl:"https://dev-ade-an.hydro.online",bidUrl:"https://dev-bid-router-an.hydro.online",eventURl:"https://dev-events-an.hydro.online",encryptionKey:"u8vB3tY5wQz9LmNp4RfXc2PkSjVh6DnO",HydroDefaultBannerPath:"https://dev-creativestore-an.hydro.online/ad_hydro_default",impressionDelay:parseInt("29000",10),useEncryption:!0,tagConfigUrl:"https://ad-traffic-regulation-config.hydro.online/tags.json"};function b(){return{countryCode:new URLSearchParams(document.currentScript.src.split("?")[1]).get("country_code")}}var g=class{constructor(){this.sessionData={hostname:window.location.hostname,adSessionId:null,adClicked:!1,clickTimestamp:null,timeDelay:18e4,countryCode:b().countryCode,lastAccessed:Date.now(),alreadyShownAds:[]},this.initialize()}initialize(){let e=sessionStorage.getItem("adSessionData");if(e){let t=JSON.parse(e);t.hostname===window.location.hostname?(this.sessionData=A(w({},t),{lastAccessed:Date.now(),countryCode:b().countryCode}),this.save()):this.reset()}else this.reset()}reset(){this.sessionData=A(w({},this.sessionData),{adSessionId:u(),adClicked:!1,clickTimestamp:null,lastAccessed:Date.now(),alreadyShownAds:[]}),this.save()}save(){sessionStorage.setItem("adSessionData",JSON.stringify(this.sessionData))}get adSessionId(){return this.sessionData.adSessionId}get countryCode(){return this.sessionData.countryCode}get alreadyShownAds(){return this.sessionData.alreadyShownAds}addShownAd(e){this.sessionData.alreadyShownAds.includes(e)||(this.sessionData.alreadyShownAds.push(e),this.save())}resetShownAds(){this.sessionData.alreadyShownAds=[],this.save()}recordClick(){this.sessionData.adClicked=!0,this.sessionData.clickTimestamp=Date.now(),this.save()}shouldShowAd(){return this.sessionData.adClicked?Date.now()-this.sessionData.clickTimestamp>=this.sessionData.timeDelay:!0}};var p={encrypt(r){if(!d.useEncryption)return r;let t=(s=>s.split("").map(a=>a.charCodeAt(0)))(d.encryptionKey),n=t.length,i=JSON.stringify(r).split("").map((s,a)=>s.charCodeAt(0)^t[a%n]),o=String.fromCharCode(...i);return btoa(o)},decrypt(r){if(!d.useEncryption)return r;try{let e=atob(r),t=d.encryptionKey.split("").map(s=>s.charCodeAt(0)),n=t.length,i=e.split("").map((s,a)=>s.charCodeAt(0)^t[a%n]),o=String.fromCharCode(...i);return JSON.parse(o)}catch(e){throw console.error("Decryption error:",e),new Error("Decryption failed")}},preparePayload(r){return d.useEncryption?{data:this.encrypt(r)}:r},processResponse(r){return d.useEncryption?this.decrypt(r.data):r}};var f=class{constructor(e){this.sessionManager=e,this.currentAdData=null,this.currentAdRequestId=null,this.isFetchingAd=!1,this.tagId=window.Hydro_tagId}fetchAd(){return l(this,null,function*(){if(this.isFetchingAd)return null;this.isFetchingAd=!0,this.currentAdRequestId=u();try{let e=`${d.bidUrl}/api/v1/ad/fetch`,t={ad_session_id:this.sessionManager.adSessionId,tag_id:this.tagId,ad_request_id:this.currentAdRequestId,pot_session_id:window.session_id,already_shown_ad_ids:this.sessionManager.alreadyShownAds.join(","),request_timestamp:Math.floor(Date.now()/1e3)},n=yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`API response error: ${n.status}`);let i=yield n.json();return this.processResponseData(i),console.log("Ad fetched successfully:",this.currentAdData),this.currentAdData}catch(e){return console.error("Error fetching ad:",e),this.currentAdData=null,null}finally{this.isFetchingAd=!1}})}processResponseData(e){var n,i,o;let t=e;if(d.useEncryption&&e.encryptedData)try{let s=p.decrypt(e.encryptedData,d.encryptionKey);t=JSON.parse(s)}catch(s){return console.error("Error decrypting ad data:",s),null}if(t.seatbid&&t.seatbid.length>0&&t.seatbid[0].bid&&t.seatbid[0].bid.length>0){let s=t.seatbid[0].bid[0],a=((n=t.ext)==null?void 0:n.dsp_channel)||"",c=((i=t.ext)==null?void 0:i.device_type)||"";if(this.currentAdData={adReqId:t.id,campaignId:s.cid,deviceType:c,dspChannel:a,width:s.w,height:s.h,price:s.price,impid:s.impid,currency:t.cur,nurl:s.nurl,lurl:s.lurl,adm:s.adm,adid:s.adid,imageUrl:s.iurl,redirectUrl:a==="ad-kernel"?"":(o=s.ext)==null?void 0:o.redirect_url,pos:s.pos!==void 0?s.pos:5},this.currentAdData.rawBid=s,a==="ad-kernel"&&s.nurl){let h=s.nurl.replace("${AUCTION_PRICE}",s.price);this.triggerWinNotification(h)}return this.currentAdData.adId&&this.sessionManager.addShownAd(this.currentAdData.adId),this.currentAdData}return null}triggerWinNotification(e){return l(this,null,function*(){if(e)try{console.log("Attempting to send win notification to:",e);let t=yield fetch(e,{method:"GET",mode:"no-cors"});console.log("Win notification sent successfully to:",e)}catch(t){console.error("Error sending win notification:",t)}})}triggerLossNotification(e){return l(this,null,function*(){if(e)try{console.log("Attempting to send loss notification to:",e);let t=yield fetch(e,{method:"GET",mode:"no-cors"});console.log("Loss notification sent successfully to:",e)}catch(t){console.error("Error sending loss notification:",t)}})}getCurrentAdData(){return this.currentAdData}getCurrentAdRequestId(){return this.currentAdRequestId}};var y=class{constructor(e,t){this.sessionManager=e,this.adService=t}sendImpressionEvent(){return l(this,null,function*(){var t;let e=this.adService.getCurrentAdData();if(e)try{let n={ad_session_id:this.sessionManager.adSessionId,ad_id:e.adid,pot_session_id:window.session_id,ad_request_id:e.adReqId,ad_position:"middle",campaign_id:e.campaignId,tag_id:window.Hydro_tagId,device_type:e.deviceType,request_timestamp:Math.floor(Date.now()/1e3),bid_price:e.price,bid_currency:e.currency,dsp_channel:e.dspChannel,w:e.width,h:e.height,pos:e.pos,impid:e.impid};console.log("Impression Event Payload:",n);let i=p.preparePayload(n);if(console.log("Processed Payload:",i),e.dspChannel==="ad-kernel"){if(e.nurl){let c=e.nurl.replace("${AUCTION_PRICE}",e.price);yield this.triggerNotification(c)}(t=e.rawBid)!=null&&t.burl&&(yield this.triggerNotification(e.rawBid.burl));let o=yield fetch(`${d.eventURl}/api/v1/ad-display`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let s=yield o.json(),a=p.processResponse(s);console.log("Ad-kernel impression event sent:",a)}else if(e.dspChannel==="hydro"){let o=yield fetch(`${d.eventURl}/api/v1/ad-display`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let s=yield o.json(),a=p.processResponse(s);console.log("Hydro impression event sent:",a)}}catch(n){console.error("Error sending impression event:",n)}})}triggerNotification(e){return l(this,null,function*(){if(e)try{console.log("Attempting to send notification to:",e);let t=yield fetch(e,{method:"GET",mode:"no-cors"});console.log("Notification sent successfully to:",e)}catch(t){console.error("Error sending notification:",t)}})}sendClickEvent(){return l(this,null,function*(){let e=this.adService.getCurrentAdData();if(!e)return null;try{let t={ad_session_id:this.sessionManager.adSessionId,ad_id:e.adId||e.adid,pot_session_id:window.session_id,ad_request_id:this.adService.getCurrentAdRequestId(),campaign_id:e.campaignId,tag_id:window.Hydro_tagId,redirect_url:e.redirectUrl,device_type:e.deviceType,request_timestamp:Math.floor(Date.now()/1e3),bid_price:e.price,bid_currency:e.currency,dsp_channel:e.dspChannel,w:e.width,h:e.height,pos:e.pos,impid:e.impid};console.log("Click Event Payload:",t);let n=p.preparePayload(t);console.log("Processed Click Payload:",n);let i=yield fetch(`${d.eventURl}/api/v1/ad-click`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let o=yield i.json(),s=p.processResponse(o);return console.log("Click event sent:",s),e.dspChannel==="hydro"&&e.redirectUrl?(window.open(e.redirectUrl,"_blank"),e.redirectUrl):null}catch(t){return console.error("Error sending click event:",t),null}})}};var m=class{constructor(e,t,n){this.sessionManager=e,this.adService=t,this.eventService=n,this.adContainer=null,this.isAdClosed=!0,this.currentAdRefreshTimer=null,this.currentImpressionTimer=null}createAdContainer(){this.adContainer?this.clearContainer():(this.adContainer=document.createElement("div"),document.body.appendChild(this.adContainer)),Object.assign(this.adContainer.style,{position:"fixed",zIndex:"2147483647",overflow:"hidden",display:"none",transition:"all 0.3s ease"})}displayBanner(){return l(this,null,function*(){let e=this.adService.getCurrentAdData();if(!e||!this.adContainer)return;this.clearContainer(),this.positionAdContainer(e.pos||0);let t=document.createElement("div");t.style.position="relative",t.style.transition="all 0.3s ease";let n=document.createElement("div");Object.assign(n.style,{position:"absolute",top:"5px",right:"5px",width:"24px",height:"24px",borderRadius:"50%",backgroundColor:"rgb(186 14 14 / 80%)",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",fontSize:"18px",fontWeight:"bold",zIndex:"999",boxShadow:"0 1px 3px rgba(0,0,0,0.3)"}),n.innerHTML="&times;",n.addEventListener("click",i=>{i.stopPropagation(),e.redirectUrl&&(this.sessionManager.recordClick(),this.eventService.sendClickEvent(),window.open(e.redirectUrl,"_blank")),this.closeAd()});try{if(e.dspChannel==="ad-kernel"&&e.adm){if(t.innerHTML=e.adm,!t.innerHTML.trim()){console.error("ADM content failed to render properly"),this.callLossUrl(e);return}t.querySelectorAll("a").forEach(i=>{i.getAttribute("target")||i.setAttribute("target","_blank")})}else{let i=document.createElement("img");i.id="hydro-ad-image",i.style.display="block",i.style.maxWidth="100%",i.style.cursor="pointer",i.onerror=()=>{console.error("Failed to load ad image"),this.callLossUrl(e),this.clearContainer()},i.src=v(e.imageUrl,!0),t.style.cursor="pointer",t.addEventListener("click",()=>{e.redirectUrl&&(this.sessionManager.recordClick(),this.eventService.sendClickEvent(),window.open(e.redirectUrl,"_blank"))}),t.appendChild(i)}t.appendChild(n),this.adContainer.appendChild(t),this.adContainer.style.display="block",this.isAdClosed=!1,window.addEventListener("resize",this.debounce(this.updateAdSize.bind(this),250)),this.currentImpressionTimer&&clearTimeout(this.currentImpressionTimer),this.currentImpressionTimer=setTimeout(()=>{this.eventService.sendImpressionEvent(),this.currentImpressionTimer=null},1e3),this.currentAdRefreshTimer&&clearTimeout(this.currentAdRefreshTimer),this.currentAdRefreshTimer=setTimeout(()=>{this.fetchNewAd(),this.currentAdRefreshTimer=null},d.impressionDelay)}catch(i){console.error("Error displaying banner:",i),this.callLossUrl(e),this.clearContainer()}})}callLossUrl(e){e&&e.lurl&&(console.log("Ad display failed, triggering loss URL"),this.adService.triggerLossNotification(e.lurl))}positionAdContainer(e){let t=S(),n=window.innerHeight,i=window.innerWidth;switch(Object.assign(this.adContainer.style,{top:"auto",right:"auto",bottom:"auto",left:"auto",width:"auto",height:"auto",margin:"0",transform:"none",position:"fixed",backgroundColor:"transparent",padding:"0",borderRadius:"0",display:"block",justifyContent:"normal",alignItems:"normal",maxWidth:"none",maxHeight:"none"}),parseInt(e)){case 0:this.adContainer.style.bottom="0",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)";break;case 1:this.adContainer.style.top="100px",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)";break;case 3:this.adContainer.style.top=`${n+50}px`,this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)",this.adContainer.style.position="absolute";break;case 4:this.adContainer.style.top="0",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)";break;case 5:this.adContainer.style.bottom="0",this.adContainer.style.left="50%",this.adContainer.style.transform="translateX(-50%)",this.adContainer.style.width="96%",this.adContainer.style.paddingInlineInline="2%",this.adContainer.style.marginBottom="2%";break;case 6:this.adContainer.style.top="150px",this.adContainer.style.right="0",this.adContainer.style.maxWidth="300px";break;case 7:Object.assign(this.adContainer.style,{top:"0",left:"0",width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",justifyContent:"center",alignItems:"center"});break}}updateAdSize(){if(!this.adContainer)return;let e=this.adService.getCurrentAdData();if(e&&(this.positionAdContainer(e.pos||0),e.dspChannel!=="ad-kernel")){let t=document.getElementById("hydro-ad-image");if(t)try{t.src=v(e.imageUrl,!0)}catch(n){console.error("Error updating ad image:",n),this.callLossUrl(e)}}}debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}closeAd(){this.clearContainer(),this.isAdClosed=!0}clearContainer(){this.currentImpressionTimer&&(clearTimeout(this.currentImpressionTimer),this.currentImpressionTimer=null),this.currentAdRefreshTimer&&(clearTimeout(this.currentAdRefreshTimer),this.currentAdRefreshTimer=null),this.adContainer&&(this.adContainer.style.display="none",this.adContainer.innerHTML="")}fetchNewAd(){return l(this,null,function*(){if(this.clearContainer(),!this.sessionManager.shouldShowAd())return console.log("Ad cannot be fetched. Waiting for delay period."),null;try{yield this.adService.fetchAd(),this.displayBanner()}catch(e){console.error("Error fetching new ad:",e)}})}};(function(){let r=new g,e=new f(r),t=new y(r,e),n=new m(r,e,t),i=!1;window.addEventListener("beforeunload",()=>{i=!0}),document.addEventListener("visibilitychange",function(){document.hidden?i||n.closeAd():n.isAdClosed&&r.shouldShowAd()&&s()}),window.addEventListener("focus",()=>{!i&&n.isAdClosed&&r.shouldShowAd()&&s()});function o(){return l(this,null,function*(){if(r.shouldShowAd())try{n.createAdContainer(),yield e.fetchAd(),n.displayBanner()}catch(a){console.error("Failed to initialize ad:",a)}})}function s(){return l(this,null,function*(){try{if(!window.Hydro_tagId){console.log("No Hydro tag ID found, proceeding with ads"),o();return}let a=d.tagConfigUrl,c=yield fetch(a);if(!c.ok){console.log("Could not load tag configuration, proceeding with ads"),o();return}let h=yield c.json(),C=window.Hydro_tagId;if(h&&h.tags&&h.tags[C]&&h.tags[C].show_ad===!1){console.log(`Tag ${C} is configured to not show ads`);return}o()}catch(a){console.error("Error checking tag configuration:",a),o()}})}s(),setInterval(()=>{r.sessionData.adClicked&&n.isAdClosed&&r.shouldShowAd()&&s()},5e3)})();})();
